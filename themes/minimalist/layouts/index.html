{{ define "main" }}
<!-- Hero Section Full Width -->
<section class="home-hero">
    <div class="container">
        <div class="home-hero-layout">
            <div class="home-hero-content">
                <h1 class="home-hero-title">
                    <span class="home-hero-title-main">Welcome to<br><span style="padding-left: 5.2em;">HiT Blog</span></span>
                    <span class="home-hero-title-sub">Nơi chia sẻ kiến thức lập trình</span>
                </h1>
                <p class="home-hero-description">
                    Góc nhìn kỹ thuật về lập trình, từ nền tảng đến cách áp dụng trong các bài toán thực tế.
                </p>
            </div>

            <div class="home-hero-visual">
                <div class="hero-dev-card">
                    <div class="hero-dev-header">
                        <span class="hero-dot hero-dot--red"></span>
                        <span class="hero-dot hero-dot--yellow"></span>
                        <span class="hero-dot hero-dot--green"></span>
                        <span class="hero-dev-title">HiT.dev — coding in progress</span>
                    </div>
                    <div class="hero-dev-body">
                        <pre><code>// build. learn. share.
function helloHiT() {
  const stack = ["Java", "JavaScript", "Socket", "OOP"];
  return stack.map(s =&gt; `&lt;${s}/&gt;`).join("  ");
}

console.log(helloHiT());</code></pre>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<div class="main-wrapper">
    <div class="main-content">
        <section class="home-articles">
            <div class="home-articles-header">
                <p class="home-kicker">ARTICLES AND TUTORIALS</p>
            </div>
            
            <div class="posts-list">
                {{ $posts := (where .Site.RegularPages "Section" "posts") }}
                {{ range $i, $p := $posts }}
                <article class="home-article{{ if gt $i 5 }} home-article--hidden{{ end }}" {{ if gt $i 5 }}data-home-hidden="1"{{ end }}>
                    <h3 class="home-article-title">
                        <a href="{{ $p.RelPermalink }}">{{ $p.Title }}</a>
                    </h3>

                    {{ $desc := "" }}
                    {{ with $p.Params.description }}
                        {{ $desc = . }}
                    {{ else }}
                        {{ $desc = ($p.Summary | plainify) }}
                    {{ end }}
                    {{ if $desc }}
                    <p class="home-article-summary">{{ $desc | truncate 220 }}</p>
                    {{ end }}

                    <a href="{{ $p.RelPermalink }}" class="home-article-readmore">
                        <span class="rm-text">Read more</span>
                        <span class="rm-arrows"><span class="rm-arrow rm-arrow-1">-></span>
                        <span class="rm-arrow rm-arrow-2">&gt;</span>
                        <span class="rm-arrow rm-arrow-3">&gt;</span>
                        <span class="rm-arrow rm-arrow-4">&gt;</span>
                    </span>
                    </a>
                </article>
                {{ end }}
            </div>

            <div class="home-loadmore-wrap">
                <button type="button" class="home-loadmore" id="homeLoadMore">Show more</button>
            </div>

            <script>
                (function () {
                    function revealNextBatch(batchSize) {
                        var hidden = document.querySelectorAll('[data-home-hidden="1"]');
                        for (var i = 0; i < Math.min(batchSize, hidden.length); i++) {
                            hidden[i].removeAttribute('data-home-hidden');
                            hidden[i].classList.remove('home-article--hidden');
                        }
                        return document.querySelectorAll('[data-home-hidden="1"]').length;
                    }

                    function revealPopularNext(batchSize) {
                        var hidden = document.querySelectorAll('[data-pop-hidden="1"]');
                        for (var i = 0; i < Math.min(batchSize, hidden.length); i++) {
                            hidden[i].removeAttribute('data-pop-hidden');
                            hidden[i].classList.remove('popular-item--hidden');
                        }
                        return document.querySelectorAll('[data-pop-hidden="1"]').length;
                    }

                    document.addEventListener('DOMContentLoaded', function () {
                        var btn = document.getElementById('homeLoadMore');
                        if (!btn) return;

                        var remaining = document.querySelectorAll('[data-home-hidden="1"]').length;
                        if (remaining === 0) {
                            btn.style.display = 'none';
                            return;
                        }

                        btn.addEventListener('click', function () {
                            var left = revealNextBatch(6);
                            if (left === 0) btn.style.display = 'none';
                        });

                        var popBtn = document.getElementById('popularMore');
                        if (!popBtn) return;
                        var popRemaining = document.querySelectorAll('[data-pop-hidden="1"]').length;
                        if (popRemaining === 0) {
                            popBtn.style.display = 'none';
                            return;
                        }
                        popBtn.addEventListener('click', function () {
                            var left = revealPopularNext(5);
                            if (left === 0) popBtn.style.display = 'none';
                        });
                    });
                })();
            </script>
        </section>
    </div>
    
    <aside class="sidebar">
        <div class="sidebar-section">
            <h3>BROWSE BY CATEGORY</h3>
            <div class="category-grid">
                <a href="/blog/tags/css" class="category-btn">CSS</a>
                <a href="/blog/tags/java" class="category-btn">Java</a>
                <a href="/blog/tags/javascript" class="category-btn">JavaScript</a>
                <a href="/blog/tags/oop" class="category-btn">OOP</a>
                <a href="/blog/tags/socket" class="category-btn">Socket</a>
                <a href="/blog/tags/dom" class="category-btn">DOM</a>
            </div>
        </div>
        
        <div class="sidebar-section">
            <h3>POPULAR CONTENT</h3>
            <ul class="popular-list">
                {{ $popular := (where .Site.RegularPages "Section" "posts") }}
                {{ range $i, $p := $popular }}
                <li class="popular-item{{ if gt $i 4 }} popular-item--hidden{{ end }}" {{ if gt $i 4 }}data-pop-hidden="1"{{ end }}>
                    <a href="{{ $p.RelPermalink }}">{{ $p.Title }}</a>
                </li>
                {{ end }}
            </ul>

            <button type="button" class="popular-more" id="popularMore">Show more</button>
        </div>
    </aside>
</div>
{{ end }}
